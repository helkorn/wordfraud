<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timin WordFraud</title>
    <style>
        * { margin: 0; padding: 0; }
        body { background: #000; overflow: hidden; }
        canvas { display: block; }
        .link-box {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 14px;
            color: #000000;
        }
        .link-box a {
            color: #000000;
            text-decoration: none;
        }
        .link-box a:hover {
            text-decoration: underline;
        }
        .hidden {
            display: none;
        }
        .option-container {
            margin-top: 10px;
        }
        .option-text {
            color: #000000;
            text-decoration: none;
            cursor: pointer;
        }
        .option-text:hover {
            text-decoration: underline;
        }
        .right-corner {
            position: fixed;
            top: 40px;
            right: 20px;
            text-align: right;
            color: white;
        }
    </style>
</head>
<body>
    <canvas></canvas>
    <div class="link-box" id="whatIsThisLink">
        <a href="javascript:void(0)" onclick="showOptions()">What is this?</a>
    </div>
    <div class="input-container" id="inputContainer">
        <h1>WordFraud 1.0</h1>
        <input type="text" id="letters" placeholder="Syötä kirjaimet (esim. aertspl)" autocomplete="off" disabled>
        <button id="fraudeloiButton" onclick="findWords()" disabled>Fraudeloi</button>
    </div>
    <div class="container" id="mainContainer" style="display: none;">
        <div class="result-title" id="resultTitle"></div>
        <div class="centered">
            <div class="highlight" id="highlightMessage" style="display: none;">Huippuhyvä löytö!</div>
            <div class="super-highlight" id="superHighlightMessage" style="display: none;">SUPERLÖYTÖ!</div>
        </div>
        <div class="columns">
            <div class="column" id="column1"></div>
            <div class="column" id="column2"></div>
        </div>
        <div class="centered">
            <button class="reset-button" id="resetButton" onclick="resetPage()">Uudelleen</button>
        </div>
    </div>
    
    <div class="full-screen-image" id="rabbitImage" style="display: none;">
        <img src="therabbit.png" alt="Jänis">
    </div>

    <div class="right-corner hidden" id="optionsContainer"></div> <!-- Piilotettu alussa -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0"></script>
    <script>
        let words = new Set();
        let offensiveWords = new Set();
        let isDataLoaded = false;
        let isOffensiveLoaded = false;
        const medianThreshold = 50; // Oletettu mediaaniarvo huippuhyville löydöille
        const superThreshold = 75; // Oletettu raja-arvo superlöydölle

        // Ladataan tavalliset sanat CSV-tiedostosta
        Papa.parse('https://raw.githubusercontent.com/timosalonen/wordfraud/main/wordfraudFI.csv', {
            download: true,
            complete: function(results) {
                results.data.flat().map(word => word.trim()).filter(Boolean).forEach(word => {
                    words.add(word.toLowerCase());
                });
                console.log('Sanat ladattu:', words.size);
                isDataLoaded = true;
                checkIfAllLoaded();
            }
        });

        // Ladataan rivot sanat CSV-tiedostosta
        Papa.parse('https://raw.githubusercontent.com/timosalonen/wordfraud/main/offensiveFI.csv', {
            download: true,
            complete: function(results) {
                results.data.flat().map(word => word.trim()).filter(Boolean).forEach(word => {
                    offensiveWords.add(word.toLowerCase());
                });
                console.log('Rivot sanat ladattu:', offensiveWords.size);
                isOffensiveLoaded = true;
                checkIfAllLoaded();
            }
        });

        function checkIfAllLoaded() {
            if (isDataLoaded && isOffensiveLoaded) {
                document.getElementById('letters').disabled = false;
                document.getElementById('fraudeloiButton').disabled = false;
            }
        }

        function isValidWord(word) {
            return words.has(word);
        }

        function isOffensiveWord(word) {
            return offensiveWords.has(word);
        }

        function getAllCombinations(letters) {
            let results = new Set();

            function combine(prefix, letters) {
                for (let i = 0; i < letters.length; i++) {
                    let newPrefix = prefix + letters[i];
                    if (isValidWord(newPrefix)) {
                        results.add(newPrefix);
                    }
                    combine(newPrefix, letters.slice(0, i) + letters.slice(i + 1));
                }
            }

            combine('', letters);
            return Array.from(results).sort();
        }

        function showConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function findWords() {
            if (!isDataLoaded || !isOffensiveLoaded) {
                alert('Sanat eivät ole vielä latautuneet. Odota hetki ja yritä uudelleen.');
                return;
            }

            const letters = document.getElementById('letters').value.toUpperCase();
            const column1 = document.getElementById('column1');
            const column2 = document.getElementById('column2');
            const resultTitle = document.getElementById('resultTitle');
            const highlightMessage = document.getElementById('highlightMessage');
            const superHighlightMessage = document.getElementById('superHighlightMessage');
            const fraudeloiButton = document.getElementById('fraudeloiButton');
            const resetButton = document.getElementById('resetButton');
            const mainContainer = document.getElementById('mainContainer');
            const inputContainer = document.getElementById('inputContainer');
            const rabbitImage = document.getElementById('rabbitImage');
            column1.innerHTML = '';
            column2.innerHTML = '';
            resultTitle.style.display = 'none';
            highlightMessage.style.display = 'none';
            superHighlightMessage.style.display = 'none';
            if (letters.length < 2 || letters.length > 7) {
                alert("Anna 2-7 kirjainta.");
                return;
            }
            console.time('findPossibleWords');
            const possibleWords = getAllCombinations(letters.toLowerCase());
            console.timeEnd('findPossibleWords');

            const containsOffensive = possibleWords.some(word => isOffensiveWord(word.toLowerCase()));

            if (possibleWords.length === 0) {
                const noResults = document.createElement('div');
                noResults.textContent = 'Ei löydettyjä sanoja';
                noResults.classList.add('no-results');
                column1.appendChild(noResults);
            } else {
                possibleWords.forEach((word, index) => {
                    const li = document.createElement('li');
                    li.textContent = word.toUpperCase();
                    li.onclick = () => findWordsForWord(word.toUpperCase());
                    if (index % 2 === 0) {
                        column1.appendChild(li);
                    } else {
                        column2.appendChild(li);
                    }
                });
            }

            const resultCount = possibleWords.length - 1;

            if (resultCount > superThreshold) {
                superHighlightMessage.style.display = 'block';
                showConfetti();
                resultTitle.textContent = `Kysyit: ${letters}. ${letters.length} kirjainta ja ${resultCount} sanaa`;
            } else if (resultCount > medianThreshold) {
                highlightMessage.style.display = 'block';
                resultTitle.textContent = `Kysyit: ${letters}. ${letters.length kirjainta ja ${resultCount} sanaa`;
            } else {
                resultTitle.textContent = `Kysyit: ${letters}`;
            }

            inputContainer.style.display = 'none';
            mainContainer.style.display = 'block';
            resultTitle.style.display = 'block';
            resetButton.style.display = 'block';

            if (letters === 'JÄNIS') {
                resultTitle.textContent += ". Onks kello hyvin?";
                setTimeout(() => {
                    rabbitImage.style.display = 'flex';
                    setTimeout(() => {
                        rabbitImage.style.display = 'none';
                        resultTitle.innerHTML = `Kysyit: ${letters}. <a href="https://youtu.be/0wHXcv4Q4Sk" style="color: black; text-decoration: underline;">Hei mikä toi on?</a>`;
                    }, 1500);
                }, 500);
            }

            window.scrollTo(0, 0);
        }

        function showOptions() {
            document.getElementById('whatIsThisLink').style.display = 'none';
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.classList.remove('hidden');
            optionsContainer.innerHTML = `
                <p>Did you mean..?</p>
                <a class="option-text" onclick="chooseOption('this')">What is this?</a><br>
                <a class="option-text" onclick="chooseOption('that')">Or What is that?</a>
            `;
        }

        function chooseOption(option) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (option === 'this') {
                optionsContainer.innerHTML = `
                    <p>This is where you are.</p>
                    <div class="option-container">
                        <a class="option-text" href="https://youtu.be/N2ICtCO8TCw">Take That</a><br>
                        <a class="option-text" onclick="continueOption()">Continue</a>
                    </div>
                `;
            } else if (option === 'that') {
                optionsContainer.innerHTML = `
                    <p>That is imperfect of this.</p>
                    <div class="option-container">
                        <a class="option-text" onclick="lockInAnswer()">Sure Thing I Call.</a><br>
                        <a class="option-text" href="https://youtu.be/-crgQGdpZR0">Or Take A Change</a>
                    </div>
                `;
            }
        }

        function continueOption() {
            document.body.innerHTML = '<canvas></canvas>';
            var canvas = document.querySelector('canvas');
            var ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            setTimeout(() => {
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = '#fff';
                ctx.font = '30px fontC64';
                ctx.fillText('...', 20, 30);

                setTimeout(() => {
                    ctx.fillText('..', 20, 30);
                }, 500);

                setTimeout(() => {
                    ctx.fillText('.', 20, 30);
                }, 1000);

                setTimeout(() => {
                    ctx.fillText('', 20, 30);
                    ctx.fillRect(0, 40, canvas.width, 5);

                    setTimeout(() => {
                        ctx.fillStyle = '#000';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);

                        ctx.font = '20px fontC64';
                        var lines = [
                            'SYS 64738',
                            'POKE 53280, 0',
                            'READY.',
                            '',
                            '10 INPUT "CHOOSE YOUR PILL 1 or 2:", V',
                            '20 IF V = 1 THEN GOTO 10',
                            '30 IF V = 2 THEN GOTO 3000',
                            '40 IF V <> 1 AND V <> 2 THEN GOSUB 3500',
                            '50 END',
                            '',
                            '3010 LOAD "PACMAN",8,1',
                            '3020 RUN',
                            '',
                            '3500 PRINT "You take the blue pill, the story ends. You wake up in your bed and believe whatever you want to believe. You take the red pill, you stay in Wonderland, and I show you how deep the rabbit hole goes."',
                            '3510 END'
                        ];
                        var y = 30;
                        var delay = 100;

                        lines.forEach((line, index) => {
                            setTimeout(() => {
                                ctx.fillText(line, 20, y);
                                y += 30;
                            }, delay * index);
                        });

                        setTimeout(() => {
                            document.body.innerHTML = '';
                            var matrixCanvas = document.createElement('canvas');
                            document.body.appendChild(matrixCanvas);
                            var matrixCtx = matrixCanvas.getContext('2d');

                            matrixCanvas.width = window.innerWidth;
                            matrixCanvas.height = window.innerHeight;

                            var letters = 'ABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZ';
                            letters = letters.split('');

                            var fontSize = 10;
                            var columns = matrixCanvas.width / fontSize;

                            var drops = [];
                            for (var i = 0; i < columns; i++) {
                                drops[i] = 1;
                            }

                            function drawMatrix() {
                                matrixCtx.fillStyle = 'rgba(0, 0, 0, .1)';
                                matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
                                matrixCtx.font = fontSize + 'px arial';
                                for (var i = 0; i < drops.length; i++) {
                                    var text = letters[Math.floor(Math.random() * letters.length)];
                                    matrixCtx.fillStyle = '#0f0';
                                    matrixCtx.fillText(text, i * fontSize, drops[i] * fontSize);
                                    drops[i]++;
                                    if (drops[i] * fontSize > matrixCanvas.height && Math.random() > .95) {
                                        drops[i] = 0;
                                    }
                                }
                            }

                            setInterval(drawMatrix, 33);

                            setTimeout(() => {
                                window.location.href = 'pacman.html';
                            }, 3000);
                        }, delay * lines.length + 3000);
                    }, 1500);
                }, 1500);
            }, 500);
        }

        function lockInAnswer() {
            // Tämä funktio ohjaa WordPorn-sivulle
            window.location.href = 'wordporn.html';
        }

        function findWordsForWord(word) {
            document.getElementById('letters').value = word;
            findWords();
        }

        function resetPage() {
            location.reload();
        }
    </script>
</body>
</html>
