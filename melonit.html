<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melonit</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(6, 50px);
            grid-template-rows: repeat(6, 50px);
            gap: 5px;
        }
        .grid div {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            color: #000;
            font-size: 24px;
            cursor: pointer;
            transition: background-color 0.5s, border-radius 0.5s;
        }
        .grid .highlight {
            background-color: pink;
            color: #000;
            border-radius: 10%;
        }
        .grid .error {
            background-color: grey;
        }
        .message, .timer {
            font-size: 24px;
            margin-top: 20px;
        }
        .image-container {
            display: none;
            margin-top: 20px;
            border: 2px solid silver;
            width: 400px;
            height: 400px;
            overflow: hidden;
        }
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 4s ease-in-out;
        }
    </style>
</head>
<body>

<div class="grid" id="grid"></div>
<div class="message" id="message">ETSI LEMPINIMI RINNOILLE</div>
<div class="timer" id="timer">30:00</div>
<div class="image-container" id="imageContainer">
    <img id="image" src="" alt="Rinnat">
</div>

<script>
    const words = ["ajovalot", "anderssonit", "avokadot", "bazookat", "bon-bonit", "burritot", "daisarit", "etuessu", "etuvalot", "hinkit", "iso-deet", "kannut", "kellukkeet", "ketunnokat", "manboobs", "meijerit", "melonit", "michelin-manit", "nuuskapussit", "roiskeläpät", "swingerit", "tissit", "tonkat", "tuutit"];
    let grid = document.getElementById('grid');
    let message = document.getElementById('message');
    let timer = document.getElementById('timer');
    let imageContainer = document.getElementById('imageContainer');
    let image = document.getElementById('image');
    let selectedWord = words[Math.floor(Math.random() * words.length)].toUpperCase();
    let highlightedIndices = [];
    let timerInterval;
    let highlightInterval;
    let timeLeft = 30;

    function initializeGrid() {
        grid.innerHTML = '';
        for (let i = 0; i < 36; i++) {
            let cell = document.createElement('div');
            cell.textContent = String.fromCharCode(65 + Math.floor(Math.random() * 26));
            grid.appendChild(cell);
        }
        placeWord();
    }

    function placeWord() {
        let directions = ['up', 'down', 'left', 'right'];
        let startPos = Math.floor(Math.random() * 36);
        let direction = directions[Math.floor(Math.random() * directions.length)];
        let x = startPos % 6;
        let y = Math.floor(startPos / 6);
        let positions = [];

        for (let char of selectedWord) {
            if (x < 0 || x >= 6 || y < 0 || y >= 6) {
                return placeWord();
            }
            positions.push(y * 6 + x);
            if (direction === 'up') y--;
            if (direction === 'down') y++;
            if (direction === 'left') x--;
            if (direction === 'right') x++;
        }
        for (let i = 0; i < selectedWord.length; i++) {
            grid.children[positions[i]].textContent = selectedWord[i];
        }
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            timer.textContent = `00:${timeLeft < 10 ? '0' + timeLeft : timeLeft}`;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                grid.classList.add('error');
                setTimeout(() => {
                    grid.classList.remove('error');
                    initializeGrid();
                    startGame();
                }, 500);
            }
        }, 1000);
    }

    function startHighlight() {
        let index = 0;
        highlightInterval = setInterval(() => {
            if (index < selectedWord.length) {
                highlightCell(index);
                index++;
            } else {
                clearInterval(highlightInterval);
            }
        }, 5000);
    }

    function highlightCell(index) {
        grid.children[highlightedIndices[index]].classList.add('highlight');
    }

    function checkCell(cell, index) {
        if (highlightedIndices.includes(index)) {
            if (grid.children[index].textContent === selectedWord[highlightedIndices.indexOf(index)]) {
                grid.children[index].classList.add('highlight');
                if (highlightedIndices.every(idx => grid.children[idx].classList.contains('highlight'))) {
                    endGame();
                }
            } else {
                grid.children[index].classList.add('error');
                setTimeout(() => {
                    grid.children[index].classList.remove('error');
                }, 500);
            }
        }
    }

    function endGame() {
        clearInterval(timerInterval);
        clearInterval(highlightInterval);
        message.textContent = `SINULLE OIKEAT RINNAT OVAT ${selectedWord}`;
        setTimeout(() => {
            showImage();
        }, 3000);
    }

    function showImage() {
        imageContainer.style.display = 'block';
        image.src = `./titpics/${selectedWord.toLowerCase()}.png`;
        setTimeout(() => {
            image.style.transform = 'scale(2)';
        }, 100);
    }

    function startGame() {
        highlightedIndices = [];
        for (let i = 0; i < grid.children.length; i++) {
            grid.children[i].classList.remove('highlight', 'error');
            grid.children[i].addEventListener('click', () => checkCell(grid.children[i], i));
        }
        for (let char of selectedWord) {
            highlightedIndices.push(Array.from(grid.children).findIndex(cell => cell.textContent === char));
        }
        startTimer();
        startHighlight();
    }

    initializeGrid();
    startGame();
</script>
</body>
</html>
